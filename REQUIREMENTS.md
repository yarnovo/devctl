# devctl 需求文档

## 项目概述

devctl 是一个简单的 npm 包，用于将 `npm run dev` 命令置于后台运行。它是一个轻量级的代理工具，不控制端口或其他配置，只负责后台执行和日志记录。

## 目标用户

- 前端开发者
- 需要后台运行开发服务器的开发者

## 核心功能需求

### 1. 后台服务管理

#### 1.1 启动服务 (`devctl start`)
- **功能描述**：将 `npm run dev` 置于后台执行
- **输出**：启动状态、进程 ID
- **异常处理**：检测服务是否已启动，避免重复启动

#### 1.2 停止服务 (`devctl stop`)
- **功能描述**：停止后台运行的开发服务器
- **输出**：停止确认信息
- **异常处理**：进程不存在时自动清理 PID 文件

#### 1.3 重启服务 (`devctl restart`)
- **功能描述**：重启开发服务器
- **流程**：先停止现有服务，然后重新启动

#### 1.4 服务状态查询 (`devctl status`)
- **功能描述**：查看当前开发服务器的运行状态
- **输出信息**：
  - 运行状态（运行中/已停止）
  - 进程 ID
  - 运行时长

#### 1.5 查看日志 (`devctl logs`)
- **功能描述**：实时查看开发服务器的日志输出

### 2. 日志管理

#### 2.1 日志输出
- **功能描述**：将 `npm run dev` 的控制台输出重定向到日志文件
- **日志位置**：项目根目录下的 `logs/dev.log`
- **日志内容**：开发服务器的原始输出，不做任何处理

#### 2.2 实时日志查看
- **功能描述**：实时显示开发服务器的日志输出
- **实现方式**：类似 `tail -f` 的实时跟随模式
- **退出方式**：Ctrl+C 退出

## 技术需求

### 1. 技术栈
- **开发语言**：TypeScript
- **模块规范**：ESM
- **运行环境**：Node.js >= 14.0.0
- **包管理**：npm
- **构建工具**：tsc

### 2. 核心依赖
- **CLI 框架**：commander.js
- **Node.js 内置模块**：
  - `child_process`：进程管理
  - `fs`：文件操作
  - `path`：路径处理

## 命令行接口设计

### 基础命令结构
```bash
devctl <command>
```

### 具体命令

#### 启动服务
```bash
devctl start
```

#### 停止服务
```bash
devctl stop
```

#### 重启服务
```bash
devctl restart
```

#### 查看状态
```bash
devctl status
```

#### 查看日志
```bash
devctl logs
```

## 文件结构规范

### 1. 日志文件
```
logs/
├── dev.log          # 开发服务器日志
└── dev.pid          # 进程 ID 文件
```

## 错误处理需求

### 1. 常见错误场景
- `npm run dev` 命令不存在
- 权限不足无法创建日志目录
- 进程意外终止
- 重复启动

### 2. 错误处理策略
- 提供友好的错误信息
- 自动清理无效的 PID 文件

## 验收标准

### 1. 功能完整性
- 5 个核心命令正常工作
- 后台进程管理正确
- 日志记录正常

### 2. 代码质量
- TypeScript 编译无错误
- ESLint 检查通过
- 单元测试覆盖核心功能

### 3. 兼容性
- 跨平台支持（Windows、macOS、Linux）
- Node.js >= 14.0.0